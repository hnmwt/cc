# 外観検査アプリケーション仕様書

## 1. 概要

本アプリケーションは、製造現場における製品の外観検査を自動化・効率化するためのシステムです。
画像処理技術を用いて、製品の傷、汚れ、変色などの欠陥を自動検出します。

## 2. 主要機能

### 2.1 画像入力機能
- **カメラからのリアルタイム取得**
  - USBカメラ、産業用カメラに対応
  - 解像度設定（640x480 ～ 1920x1080）
  - フレームレート調整（15fps ～ 60fps）

- **ファイルからの読み込み**
  - 対応形式：JPEG, PNG, BMP, TIFF
  - バッチ処理対応（複数ファイルの一括検査）

### 2.2 画像前処理機能
- グレースケール変換
- ノイズ除去（ガウシアンフィルタ、メディアンフィルタ）
- コントラスト調整
- 二値化処理（固定閾値、適応的閾値）
- エッジ検出（Canny, Sobel）
- モルフォロジー演算（膨張、収縮、オープニング、クロージング）

### 2.3 欠陥検出機能
- **テンプレートマッチング方式**
  - 良品画像との差分検出
  - マッチング精度の閾値設定

- **特徴量ベース検出**
  - 輪郭検出
  - 面積・周囲長・円形度の計算
  - 異常値の判定

- **統計的手法**
  - ヒストグラム解析
  - 標準偏差による異常検出

### 2.4 検査結果表示機能
- **リアルタイム表示**
  - 原画像の表示
  - 処理後画像の表示
  - 欠陥検出箇所のハイライト表示（矩形、円形マーカー）

- **判定結果**
  - OK/NG判定
  - 欠陥の種類分類（傷、汚れ、変色、形状不良など）
  - 検出された欠陥の数
  - 信頼度スコア

### 2.5 データ管理機能
- **検査履歴の保存**
  - 検査日時
  - 検査画像
  - 判定結果
  - 欠陥位置情報

- **データベース**
  - SQLiteによるローカルDB
  - 検査データのCSVエクスポート

- **統計情報**
  - 日次/週次/月次の検査統計
  - 不良率の推移グラフ
  - 欠陥種類別の分布

### 2.6 設定機能
- **検査パラメータ設定**
  - 検出感度調整
  - 閾値設定
  - フィルタパラメータ

- **カメラ設定**
  - 露出、ゲイン、ホワイトバランス
  - キャリブレーション

- **良品登録**
  - リファレンス画像の登録
  - 複数パターンの登録

### 2.7 レポート機能
- 検査レポートの自動生成（PDF）
- 不良品画像の一覧出力
- 統計グラフの出力

## 3. 技術仕様

### 3.1 開発環境
- **言語**: C++17以上
- **画像処理ライブラリ**: OpenCV 4.x
- **GUI**: Qt 5/6 または OpenCV HighGUI
- **データベース**: SQLite3
- **ビルドシステム**: CMake

### 3.2 動作環境
- **OS**: Windows 10/11, Linux (Ubuntu 20.04以上), macOS
- **CPU**: Intel Core i5以上（推奨）
- **メモリ**: 4GB以上（推奨8GB）
- **ストレージ**: 500MB以上の空き容量
- **カメラ**: USB2.0/3.0対応カメラ

### 3.3 性能要件
- 画像処理速度: 1枚あたり100ms以下
- リアルタイム検査: 10fps以上
- 検出精度: 感度90%以上、特異度95%以上

## 4. ユーザーインターフェース

### 4.1 メイン画面
```
+--------------------------------------------------+
|  外観検査システム                      [_][□][X] |
+--------------------------------------------------+
| ファイル  設定  履歴  レポート  ヘルプ             |
+--------------------------------------------------+
|                                                  |
|  [原画像]              [処理結果]                |
|  +--------------+      +--------------+          |
|  |              |      |              |          |
|  |              |      |   欠陥表示   |          |
|  |              |      |              |          |
|  +--------------+      +--------------+          |
|                                                  |
|  [カメラ起動] [画像読込] [検査実行] [良品登録]    |
|                                                  |
|  検査結果: ____________                          |
|  判定: [ OK / NG ]                              |
|  欠陥数: 0                                       |
|  処理時間: 0 ms                                  |
|                                                  |
|  パラメータ調整:                                 |
|  感度: [=======>    ] 70%                       |
|  閾値: [========>   ] 80                        |
|                                                  |
+--------------------------------------------------+
| ステータス: 待機中                               |
+--------------------------------------------------+
```

## 5. データフロー

```
画像入力 → 前処理 → 欠陥検出 → 判定 → 結果表示 → データ保存
   ↑                                       ↓
   └─────────── 良品データベース ←──────────┘
```

## 6. 実装フェーズ

### Phase 1: 基本機能（優先度：高）
- [ ] 画像ファイルの読み込み
- [ ] 基本的な画像処理（グレースケール、二値化）
- [ ] 簡易的な欠陥検出（差分検出）
- [ ] 結果の画面表示

### Phase 2: 検出精度向上（優先度：高）
- [ ] 各種フィルタの実装
- [ ] 複数の検出アルゴリズム実装
- [ ] パラメータ調整機能

### Phase 3: データ管理（優先度：中）
- [ ] SQLiteデータベース統合
- [ ] 検査履歴の保存・閲覧
- [ ] CSVエクスポート

### Phase 4: カメラ対応（優先度：中）
- [ ] カメラデバイスの接続
- [ ] リアルタイム画像取得
- [ ] 連続検査モード

### Phase 5: UI改善（優先度：低）
- [ ] Qtベースの本格的なGUI
- [ ] 設定画面の実装
- [ ] グラフ表示機能

### Phase 6: レポート機能（優先度：低）
- [ ] PDF生成機能
- [ ] 統計分析機能
- [ ] データ可視化

## 7. セキュリティ・品質要件

- エラーハンドリングの徹底
- メモリリーク対策
- 入力値の検証
- ログ機能の実装
- ユニットテストの実装

## 8. 拡張性

将来的な拡張として以下を検討：
- AI（深層学習）による欠陥検出
- クラウド連携機能
- 複数カメラ同時制御
- 自動レポート送信機能
- 多言語対応

## 9. 参考資料

- OpenCV Documentation: https://docs.opencv.org/
- Qt Documentation: https://doc.qt.io/
- 産業用画像処理のベストプラクティス
